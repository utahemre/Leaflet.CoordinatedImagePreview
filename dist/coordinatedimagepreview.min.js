!function(e){function o(o,t){for(var i=Object.keys(t),n=0;n<i.length;n++)m[i[n]]=t[i[n]];this.item=e(o),this.init()}function t(o){var t=o;t.addClass("coordinatedImagePreviewControlContainer"),t.append('<input id="coordinatedImagePreviewControlOpenButton" class="coordinatedImagePreviewControlButton" type="image" src="./image/open.png" alt="Submit" title="'+m.openButtonTitle+'">');var n=e("#map").parent();n.append('<div id="coordinatedImagePreviewControlMainDiv" class="coordinatedImagePreviewControlMainDiv content horizontal-images"><ul id="coordinatedImagePreviewControlListUl" class="coordinatedImagePreviewControlUl"></ul></div>'),e("#coordinatedImagePreviewControlMainDiv").append('<input id="coordinatedImagePreviewControlCloseButton" class="coordinatedImagePreviewControlButton" type="image" src="./image/close.png" alt="Submit" title="'+m.closeButtonTitle+'">'),e("#coordinatedImagePreviewControlOpenButton").click(function(){e("#coordinatedImagePreviewControlMainDiv")[0].style.visibility="visible",map.on("moveend",c),e("#coordinatedImagePreviewControlMenuImage").addClass("coordinatedImagePreviewControlCloseMenuImage"),e("#coordinatedImagePreviewControlMenuImage").removeClass("coordinatedImagePreviewControlOpenMenuImage"),e("#coordinatedImagePreviewControlOpenButton")[0].style.visibility="hidden",i()}),e("#coordinatedImagePreviewControlCloseButton").click(function(){e("#coordinatedImagePreviewControlMainDiv")[0].style.visibility="hidden",map.off("moveend",c),e("#coordinatedImagePreviewControlMenuImage").removeClass("coordinatedImagePreviewControlCloseMenuImage"),e("#coordinatedImagePreviewControlMenuImage").addClass("coordinatedImagePreviewControlOpenMenuImage"),e("#coordinatedImagePreviewControlOpenButton")[0].style.visibility="visible"}),m.isOpen&&e("#coordinatedImagePreviewControlOpenButton")[0].click()}function i(){var o=map.getCenter(),t=map.getBounds();e.ajax({url:m.imageServiceAddress,type:"GET",data:{lng:o.lng,lat:o.lat,minx:t._southWest.lng,miny:t._southWest.lat,maxx:t._northEast.lng,maxy:t._northEast.lat,limit:m.limit},dataType:"json",success:function(o){e("#coordinatedImagePreviewControlListUl").empty(),s=o.features;for(var i=0;i<s.length;i++)if(t.contains(L.latLng(s[i].geometry.coordinates[1],s[i].geometry.coordinates[0]))){var d='<li id="coordinatedImagePreviewControlLi'+i+'" class="coordinatedImagePreviewControlLi"><a class="example-image-link" href="'+s[i].properties.imageLink+'" data-lightbox="example-set" data-title="'+s[i].properties.description+'"><img width="150" height="100" class="example-image" src="'+s[i].properties.thumbnailLink+'" alt=""/></a></li>';e("#coordinatedImagePreviewControlListUl").append(d),e("#coordinatedImagePreviewControlLi"+i).mouseenter(function(){n(this)}),e("#coordinatedImagePreviewControlLi"+i).mouseleave(function(){a(this)}),e("#coordinatedImagePreviewControlLi"+i).mousedown(function(){r(this)})}}})}function n(e){var o=parseInt(e.id.substr(32));d(s[o])}function a(){map.removeLayer(l)}function r(e){var o=parseInt(e.id.substr(32));s[o].id}function d(e){void 0!==l&&(map.removeLayer(l),l=void 0),l=L.geoJson(e,{pointToLayer:function(e,o){return L.marker(o,{bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100}})},onEachFeature:function(e,o){o.bindTooltip(e.properties.title,{permanent:!0,direction:"auto"}).addTo(map)}}).addTo(map)}var l,s,m={imageServiceAddress:"http://yourImageSearchAddress",openButtonTitle:"Show Pictures",closeButtonTitle:"Hide Pictures",limit:10,isOpen:!1};o.prototype={init:function(){t(this.item)}},e.fn.CoordinatedImagePreviewControl=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=e(this),a=n.data("CoordinatedImagePreviewControl");a?"string"==typeof t&&a[t].apply(a,i):n.data("CoordinatedImagePreviewControl",new o(this,t))})};var c=function(){i()}}(jQuery);